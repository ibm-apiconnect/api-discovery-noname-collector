# Noname Collector For Api Discovery

This document describes the set up details for the Noname Collector for Api Discovery.

## Pre-req: Ensure helm is installed  

See here for details  
https://helm.sh/docs/intro/install/  

### Use the Helm chart to deploy the collector.  

In the helm directory, update the [values.yaml](apidiscovery/values.yaml) file based on your apiconnect provider org and authentication.

The following parameters require updates:  
 - `noname.host_name` - Field to set the host name of the Noname securities.
 - `noname.client_id` - Field to set the Client Id. The Client Id can be generated by creating a Service Account in Noname Securities. The Service Account can be accessed by logging into the Noname Security host and then clicking on the settings, followed by User Management and Service Accounts. Once navigated to the Service Accounts click on Create Service Account to create an account. Once the account is created, the user will be able to retrieve a Client Id and a Client Secret.
  - `noname.client_secret` - Field to set the Client Secret. The Client Secret will be added to a kubernetes secret as part of the deployment and then mounted on the collector deployment pod. 
  - `discovery.datasource_name` - (Optional) field to set the datasource name for all APIs discovered by the collector. If datasource name is empty, the namespace of the collected API will be used.
  - `discovery.platform_api_prefix` - The Platform API prefix has a default value of platform-api, the same as the prefix value for apiconnect on Cloud. It can be changed to match your system setup if it is different from the default.
  - `discovery.apic_host_domain` - Domain name of the API Connect instance where discovered APIs will be sent.<br /> &nbsp; Example : `us-east-a.apiconnect.automation.ibm.com`  
  - `discovery.provider_org` - The provider org name of the apiconnect manager  
  - `discovery.api_key` - An API Key can be obtained from the api-manager for the user who has access to post the API. An API key can be created by logging into the APIC Manager UI and selecting the "My API Keys" option under the profile icon from the top navigation bar. The api_key will be added to a kubernetes secret as part of the deployment and then mounted on the collector deployment pod. 
  - `discovery.namespace` -The namespace where the Noname has been deployed on your cluster.
  - `logging.log_level`: Default log_level is debug.
  - `images.api_discovery_noname_collector`: As new versions of the collectors are released updating this property will enable the upgrade of the collector deployment. Note: collectors will require updates to ensure they remain compatible with the Discovery Service. Details of these updates will be available in this repository.

Once you have made the required updates to the values.yaml file you can deploy the collector.

Run the following command to deploy the collector  
```
helm template . | kubectl apply -f -
```
Output should be as follows which indicate that the required Kubernetes Resources have been deployed for the Noname Collector

```
helm template . | kubectl apply -f -
secret/noname-client-secret created
secret/noname-porg-secret created
service/management-api-discovery-noname-collector created
deployment.apps/management-api-discovery-noname-collector created
```

Once the collector has been deployed any traffic running through it will begin to be discovered and sent to the apiconnect Discovery Service.

## Upgrading the collector

The upgrade of the Noname collector mainly refers to the changes in the [values.yaml](apidiscovery/values.yaml), especially with the `images.api_discovery_noname_collector` parameter.

The changes may include introducing a new parameter, changing existing parameters.

It is recommended to upgrade the collector from time to time.

Make sure values.yaml file is based on your apiconnect provider org, authentication and that the correct datasource is set up.

Run the following command to upgrade the collector with the new changes.

```
helm template . | kubectl apply -f -
```

## Uninstalling the collector

The collector can be uninstalled using the following command.  

```
helm template . | kubectl delete -f -
```
